<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eCommerce Product Catalog Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-100 text-gray-800;
        }
        .container {
            @apply max-w-7xl mx-auto p-4 md:p-8;
        }
        .card {
            @apply bg-white rounded-lg shadow-md p-6 mb-6;
        }
        .form-label {
            @apply block text-gray-700 text-sm font-semibold mb-2;
        }
        .form-input, .form-select {
            @apply shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200;
        }
        .btn-secondary {
            @apply bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors duration-200;
        }
        .alert {
            @apply p-3 mb-4 rounded-lg text-sm;
        }
        .alert-success {
            @apply bg-green-100 text-green-700;
        }
        .alert-error {
            @apply bg-red-100 text-red-700;
        }
        .product-card {
            @apply bg-gray-50 rounded-lg p-4 shadow-sm flex flex-col;
        }
        .product-image {
            /* Changed height from h-32 to h-24 for smaller images */
            @apply w-full h-24 object-contain mb-4 rounded-lg bg-gray-200;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-bold text-center mb-10 text-black-700">ðŸ›’ Internal Product Catalog Management</h1>

        <!-- Notification Area -->
        <div id="notification-area" class="mt-4"></div>

        <!-- Category Management Section -->
        <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-blue-600">Define New Product Category</h2>
            <form id="category-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="category-name" class="form-label">Category Name:</label>
                    <input type="text" id="category-name" class="form-input" placeholder="e.g., Smartphones, Watches" required>
                </div>
                <div>
                    <label for="category-attributes" class="form-label">Attributes (comma-separated):</label>
                    <input type="text" id="category-attributes" class="form-input" placeholder="e.g., OS,RAM,Battery Size" required>
                </div>
                <div class="md:col-span-2 flex justify-end">
                    <button type="submit" class="btn-primary">Define Category</button>
                </div>
            </form>
            <hr class="my-6 border-grey-200">
            <h3 class="text-xl font-semibold mb-3 text-blue-600">Existing Categories</h3>
            <div id="categories-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Categories will be listed here -->
            </div>
        </div>

        <!-- Product Management Section -->
         <div>
        <div class="card">
            <hr class="my-6 border-grey-200">
            <h2 class="text-2xl font-semibold mb-4 text-blue-600">Manage Products</h2>
            <form id="product-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="product-name" class="form-label">Product Name:</label>
                    <input type="text" id="product-name" class="form-input" placeholder="e.g., iPhone 15, Rolex Submariner" required>
                </div>
                <div>
                    <label for="product-category" class="form-label">Category:</label>
                    <select id="product-category" class="form-select" required>
                        <option value="">-- Select Category --</option>
                        <!-- Categories will be loaded here dynamically -->
                    </select>
                </div>
                </form>
                <!-- New: Price input -->
                <div>
                    <label for="product-price" class="form-label">Price:</label>
                    <input type="number" id="product-price" class="form-input" placeholder="e.g., 999.99" step="0.01" min="0" required>
                </div>
                <!-- Image URL input -->
                <div>
                    <label for="product-image-url" class="form-label">Image URL (optional):</label>
                    <input type="url" id="product-image-url" class="form-input" placeholder="e.g., https://example.com/image.jpg">
                </div>
                <!-- Dynamic Attributes will be inserted here -->
                <div id="dynamic-attributes" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                
                <input type="hidden" id="product-id"> <!-- Hidden field for updating products -->

                <div class="md:col-span-2 flex justify-end space-x-2">
                    <button type="submit" class="btn-primary" id="save-product-btn">Add Product</button>
                    <button type="button" class="btn-secondary" id="clear-product-form-btn">Clear Form</button>
                </div>
            </form>
            <hr class="my-6 border-gray-200">
            <h3 class="text-xl font-semibold mb-3 text-blue-600">Product List</h3>
            <div class="mb-4">
                <label for="filter-category" class="form-label">Filter by Category:</label>
                <select id="filter-category" class="form-select w-auto">
                    <option value="all">All Categories</option>
                    <!-- Categories for filtering will be loaded here -->
                </select>
            </div>
            <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Products will be listed here -->
            </div>
        </div>
    </div>
      
    <script>
        // Data Structures (Simplified for JavaScript)
        // In a real application, you might use classes or more structured objects.

        // Initial categories for demonstration
        let categories = [
            { id: 'cat-dresses', name: 'Dresses', attributes: ['Style', 'Material', 'Length'] },
            { id: 'cat-shoes', name: 'Shoes', attributes: ['Type', 'Size', 'Color'] },
            { id: 'cat-smartphones', name: 'Smartphones', attributes: ['OS', 'RAM', 'Battery Size'] },
            { id: 'cat-watches', name: 'Watches', attributes: ['Dial Color', 'Dial Size', 'Strap Type'] }
        ]; 

        // Initial products for demonstration, including image URLs and price
        let products = [
            { 
                id: 'prod-dress-001', 
                name: 'Summer Floral Dress', 
                categoryId: 'cat-dresses', 
                price: 3500.00, // Updated price for INR
                imageUrl: 'https://placehold.co/300x200/4CAF50/FFFFFF?text=Floral+Dress', 
                attributes: { 'Style': 'A-Line', 'Material': 'Cotton', 'Length': 'Knee-length' } 
            },
            { 
                id: 'prod-shoe-001', 
                name: 'Leather Loafers', 
                categoryId: 'cat-shoes', 
                price: 5500.00, // Updated price for INR
                imageUrl: 'https://placehold.co/300x200/2196F3/FFFFFF?text=Leather+Loafers', 
                attributes: { 'Type': 'Loafer', 'Size': 'US 9', 'Color': 'Brown' } 
            },
            { 
                id: 'prod-phone-001', 
                name: 'XPhone Ultra 2025', 
                categoryId: 'cat-smartphones', 
                price: 75000.00, // Updated price for INR
                imageUrl: 'https://placehold.co/300x200/FF5722/FFFFFF?text=XPhone', 
                attributes: { 'OS': 'Android 15', 'RAM': '12GB', 'Battery Size': '5000mAh' } 
            },
            { 
                id: 'prod-watch-001', 
                name: 'Classic Chrono Watch', 
                categoryId: 'cat-watches', 
                price: 18000.00, // Updated price for INR
                imageUrl: 'https://placehold.co/300x200/9C27B0/FFFFFF?text=Chrono+Watch', 
                attributes: { 'Dial Color': 'Black', 'Dial Size': '42mm', 'Strap Type': 'Leather' } 
            }
        ];   

        // Helper function to generate unique IDs
        const generateId = () => Math.random().toString(36).substring(2, 11);

        // DOM Elements
        const notificationArea = document.getElementById('notification-area');
        const categoryForm = document.getElementById('category-form');
        const categoryNameInput = document.getElementById('category-name');
        const categoryAttributesInput = document.getElementById('category-attributes');
        const categoriesListDiv = document.getElementById('categories-list');

        const productForm = document.getElementById('product-form');
        const productNameInput = document.getElementById('product-name');
        const productCategorySelect = document.getElementById('product-category');
        const productPriceInput = document.getElementById('product-price');
        const productImageURLInput = document.getElementById('product-image-url');
        const dynamicAttributesDiv = document.getElementById('dynamic-attributes');
        const productIdInput = document.getElementById('product-id');
        const saveProductBtn = document.getElementById('save-product-btn');
        const clearProductFormBtn = document.getElementById('clear-product-form-btn');
        const productsListDiv = document.getElementById('products-list');
        const filterCategorySelect = document.getElementById('filter-category');

        // --- Notification Handling ---
        const showNotification = (message, type = 'success') => {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type === 'success' ? 'alert-success' : 'alert-error'}`;
            alertDiv.textContent = message;
            notificationArea.appendChild(alertDiv);

            // Automatically remove notification after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        };

        // --- Local Storage Persistence ---
        const saveData = () => {
            localStorage.setItem('ecommerceCategories', JSON.stringify(categories));
            localStorage.setItem('ecommerceProducts', JSON.stringify(products));
            // showNotification('Data saved to local storage.', 'success'); // Commented out to reduce frequent notifications
        };

        const loadData = () => {
            const storedCategories = localStorage.getItem('ecommerceCategories');
            const storedProducts = localStorage.getItem('ecommerceProducts');

            if (storedCategories) {
                categories = JSON.parse(storedCategories);
            }
            if (storedProducts) {
                products = JSON.parse(storedProducts);
            }
            // showNotification('Data loaded from local storage.', 'success'); // Commented out to reduce frequent notifications
        };

        // --- Render Functions ---

        const renderCategories = () => {
            categoriesListDiv.innerHTML = ''; // Clear existing list
            productCategorySelect.innerHTML = '<option value="">-- Select Category --</option>'; // Clear for product form
            filterCategorySelect.innerHTML = '<option value="all">All Categories</option>'; // Clear for filter

            if (categories.length === 0) {
                categoriesListDiv.innerHTML = '<p class="text-gray-500">No categories defined yet.</p>';
                return;
            }

            categories.forEach(category => {
                // For categories list display
                const categoryCard = document.createElement('div');
                categoryCard.className = 'bg-blue-50 rounded-lg p-4 shadow-sm';
                categoryCard.innerHTML = `
                    <h4 class="font-bold text-lg text-blue-700">${category.name}</h4>
                    <p class="text-sm text-gray-600 mb-2">ID: ${category.id}</p>
                    <p class="text-sm">Attributes: <span class="font-medium">${category.attributes.join(', ')}</span></p>
                `;
                categoriesListDiv.appendChild(categoryCard);

                // For product form category select
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                productCategorySelect.appendChild(option);

                // For product filter select
                const filterOption = document.createElement('option');
                filterOption.value = category.id;
                filterOption.textContent = category.name;
                filterCategorySelect.appendChild(filterOption);
            });
            saveData(); // Save data after rendering categories
        };

        const renderProducts = (filteredCategoryId = 'all') => {
            productsListDiv.innerHTML = ''; // Clear existing list

            let productsToDisplay = products;
            if (filteredCategoryId !== 'all' && filteredCategoryId) {
                productsToDisplay = products.filter(p => p.categoryId === filteredCategoryId);
            }

            if (productsToDisplay.length === 0) {
                productsListDiv.innerHTML = '<p class="text-gray-500 md:col-span-3">No products found.</p>';
                return;
            }

            productsToDisplay.forEach(product => {
                const category = categories.find(cat => cat.id === product.categoryId);
                const categoryName = category ? category.name : 'Unknown Category';
                
                // Determine image source, with a placeholder fallback
                const imageUrl = product.imageUrl && isValidUrl(product.imageUrl) 
                                ? product.imageUrl 
                                : `https://placehold.co/100x100/CCCCCC/666666?text=No+Image`;
                
                const formattedPrice = new Intl.NumberFormat('en-IN', { // Format for Indian Rupees
                    style: 'currency',
                    currency: 'INR'
                }).format(product.price || 0);

                const productCard = document.createElement('div');
                productCard.className = 'product-card border border-gray-200';
                productCard.innerHTML = `
                    <img src="${imageUrl}" alt="${product.name || 'Product'}" class="product-image" onerror="this.onerror=null;this.src='https://placehold.co/150x100/CCCCCC/666666?text=Image+Error';">
                    <h4 class="font-bold text-lg text-gray-800 mb-1">${product.name}</h4>
                    <p class="text-sm text-blue-600 mb-2">Category: ${categoryName}</p>
                    <p class="text-md font-semibold text-green-700 mb-2">Price: ${formattedPrice}</p> <!-- Display formatted price -->
                    <div class="text-sm text-gray-700 flex-grow">
                        <p class="font-semibold mb-1">Attributes:</p>
                        <ul class="list-disc list-inside space-y-0.5 ml-2">
                            ${Object.entries(product.attributes).map(([key, value]) => `
                                <li><span class="font-medium">${key}</span>: ${value}</li>
                            `).join('')}
                        </ul>
                    </div>
                    <div class="mt-4 flex justify-end space-x-2">
                        <button class="btn-secondary px-3 py-1 text-sm edit-product-btn" data-id="${product.id}">Edit</button>
                        <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200 delete-product-btn" data-id="${product.id}">Delete</button>
                    </div>
                `;
                productsListDiv.appendChild(productCard);
            });
            saveData(); // Save data after rendering products
        };

        // Basic URL validation function
        const isValidUrl = (string) => {
            try {
                new URL(string);
                return true;
            } catch (e) {
                return false;
            }
        };

        // --- Event Handlers ---

        categoryForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = categoryNameInput.value.trim();
            const attributesStr = categoryAttributesInput.value.trim();
            const attributes = attributesStr.split(',').map(attr => attr.trim()).filter(attr => attr !== '');

            if (!name || attributes.length === 0) {
                showNotification('Please provide a category name and at least one attribute.', 'error');
                return;
            }

            // Check for duplicate category name
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                showNotification(`Category '${name}' already exists.`, 'error');
                return;
            }

            const newCategory = {
                id: generateId(),
                name: name,
                attributes: attributes
            };
            categories.push(newCategory);
            showNotification(`Category '${name}' defined successfully!`, 'success');
            categoryNameInput.value = '';
            categoryAttributesInput.value = '';
            renderCategories();
        });

        productCategorySelect.addEventListener('change', () => {
            const selectedCategoryId = productCategorySelect.value;
            dynamicAttributesDiv.innerHTML = ''; // Clear previous attributes

            if (selectedCategoryId) {
                const selectedCategory = categories.find(cat => cat.id === selectedCategoryId);
                if (selectedCategory) {
                    selectedCategory.attributes.forEach(attr => {
                        const attributeDiv = document.createElement('div');
                        attributeDiv.innerHTML = `
                            <label for="attr-${attr.replace(/\s/g, '-')}" class="form-label">${attr}:</label>
                            <input type="text" id="attr-${attr.replace(/\s/g, '-')}" data-attribute-name="${attr}" class="form-input dynamic-attribute-input" required>
                        `;
                        dynamicAttributesDiv.appendChild(attributeDiv);
                    });
                }
            }
        });

        productForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = productNameInput.value.trim();
            const categoryId = productCategorySelect.value;
            const price = parseFloat(productPriceInput.value);
            const imageUrl = productImageURLInput.value.trim();
            const productId = productIdInput.value;

            if (!name || !categoryId) {
                showNotification('Please provide a product name and select a category.', 'error');
                return;
            }

            if (isNaN(price) || price < 0) {
                showNotification('Please enter a valid positive number for the price.', 'error');
                return;
            }
            
            if (imageUrl && !isValidUrl(imageUrl)) {
                showNotification('Please enter a valid URL for the product image.', 'error');
                return;
            }

            const selectedCategory = categories.find(cat => cat.id === categoryId);
            if (!selectedCategory) {
                showNotification('Selected category not found. Please refresh and try again.', 'error');
                return;
            }

            const attributes = {};
            let allAttributesProvided = true;
            document.querySelectorAll('.dynamic-attribute-input').forEach(input => {
                const attrName = input.dataset.attributeName;
                const attrValue = input.value.trim();
                if (input.required && !attrValue) {
                    allAttributesProvided = false;
                    showNotification(`Please provide a value for '${attrName}'.`, 'error');
                    return;
                }
                attributes[attrName] = attrValue;
            });

            if (!allAttributesProvided) {
                return;
            }

            if (productId) {
                // Update existing product
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex > -1) {
                    products[productIndex].name = name;
                    products[productIndex].categoryId = categoryId;
                    products[productIndex].price = price;
                    products[productIndex].imageUrl = imageUrl;
                    products[productIndex].attributes = attributes;
                    showNotification(`Product '${name}' updated successfully!`, 'success');
                } else {
                    showNotification('Product not found for update.', 'error');
                }
            } else {
                // Create new product
                const newProduct = {
                    id: generateId(),
                    name: name,
                    categoryId: categoryId,
                    price: price,
                    imageUrl: imageUrl,
                    attributes: attributes
                };
                products.push(newProduct);
                showNotification(`Product '${name}' created successfully!`, 'success');
            }
            clearProductForm();
            renderProducts(filterCategorySelect.value); // Re-render products with current filter
        });

        productsListDiv.addEventListener('click', (e) => {
            if (e.target.classList.contains('edit-product-btn')) {
                const productId = e.target.dataset.id;
                const productToEdit = products.find(p => p.id === productId);
                if (productToEdit) {
                    productNameInput.value = productToEdit.name;
                    productCategorySelect.value = productToEdit.categoryId;
                    productPriceInput.value = productToEdit.price || '';
                    productImageURLInput.value = productToEdit.imageUrl || '';
                    productIdInput.value = productToEdit.id;
                    saveProductBtn.textContent = 'Update Product';

                    // Trigger change event to load dynamic attributes for the selected category
                    const event = new Event('change');
                    productCategorySelect.dispatchEvent(event);

                    // Populate dynamic attributes
                    setTimeout(() => { // Give a small delay for dynamic inputs to render
                        for (const attrName in productToEdit.attributes) {
                            const input = dynamicAttributesDiv.querySelector(`[data-attribute-name="${attrName}"]`);
                            if (input) {
                                input.value = productToEdit.attributes[attrName];
                            }
                        }
                    }, 50); // Small delay
                }
            } else if (e.target.classList.contains('delete-product-btn')) {
                const productId = e.target.dataset.id;
                // Using confirm for simplicity, but a custom modal is better for production
                if (confirm('Are you sure you want to delete this product?')) { 
                    products = products.filter(p => p.id !== productId);
                    showNotification('Product deleted successfully!', 'success');
                    renderProducts(filterCategorySelect.value);
                }
            }
        });

        filterCategorySelect.addEventListener('change', () => {
            renderProducts(filterCategorySelect.value);
        });

        clearProductFormBtn.addEventListener('click', () => {
            clearProductForm();
        });

        const clearProductForm = () => {
            productForm.reset();
            productIdInput.value = '';
            productPriceInput.value = '';
            productImageURLInput.value = '';
            dynamicAttributesDiv.innerHTML = ''; // Clear dynamic attributes
            saveProductBtn.textContent = 'Add Product';
            productCategorySelect.value = ''; // Reset category select
        };

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check if local storage has data, otherwise use initial data
            if (!localStorage.getItem('ecommerceCategories') && !localStorage.getItem('ecommerceProducts')) {
                saveData(); // Save the initial hardcoded data to local storage
            } else {
                loadData(); // Load existing data from local storage
            }
            renderCategories(); // Render categories first as products depend on them
            renderProducts();
        });

    </script>
</body>
</html>
s